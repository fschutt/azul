<!DOCTYPE html>
<html lang="en">
<head>
  <title>Azul GUI Framework</title>
  <!-- HEAD -->
  <style>
    * { box-sizing: border-box; }
    
    /* Shared grid layout for header and features */
    .grid-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      align-items: start;
    }
    
    /* Main header */
    main > header {
      margin-bottom: 40px;
    }

    main > header h2 {
      padding-top: 10px;
      margin-bottom: 20px;
      font-size: 30px;
      font-weight: 100;
      line-height: 0.9;
      font-family: "Instrument Serif", serif;
    }

    main > header h2 .first-letter {
      float: left;
      margin-right: 5px;
      font-family: "Morris Jenson Initialen", serif;
      font-weight: 500;
      font-size: 2.25em;
    }
  
    main > header h3 {
      margin-top: 15px;
      font-size: 1.2rem;
      font-weight: normal;
    }

    /* Feature sections - uses shared grid */
    .feature-section {
      margin-bottom: 50px;
    }
    
    .feature-image {
      min-width: 0;
    }
    
    .feature-image img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    .feature-image .description {
      margin-top: 12px;
      font-size: 0.88em;
      color: #555;
      line-height: 1.5;
    }
    
    .feature-code {
      min-width: 0;
    }

    /* Tab bar - Flexbox */
    .tab-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
      margin-bottom: 0;
    }
    
    /* Language grid - 5 columns for future expansion */
    .lang-grid {
      display: grid;
      grid-template-columns: repeat(5, auto);
      gap: 2px;
    }
    
    .lang-grid button {
      padding: 4px 10px;
      border: none;
      background: #e0e0e0;
      cursor: pointer;
      font-family: monospace;
      font-size: 11px;
      font-weight: bold;
    }
    
    .lang-grid button.active {
      background: #0084ff;
      color: white;
    }
    
    .lang-grid button:hover:not(.active):not(.lang-disabled) {
      background: #d0d0d0;
    }
    
    .lang-grid button.lang-disabled {
      background: #f0f0f0;
      color: #aaa;
      cursor: not-allowed;
    }
    
    /* Install controls - grouped together */
    .install-controls {
      display: flex;
      gap: 4px;
      align-items: center;
      margin-left: auto;
    }

    .tab-bar select {
      padding: 4px 6px;
      border: 1px solid #ccc;
      background: #f8f8f8;
      cursor: pointer;
      font-family: monospace;
      font-size: 11px;
      font-weight: bold;
    }

    /* Code panel */
    .code-panel {
      background: #fafafa;
      border: 1px solid #ddd;
      font-family: monospace;
      font-size: 12px;
      font-weight: 600;
    }
    
    /* Install commands - dark */
    .install-commands {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 10px 12px;
    }
    
    .install-step {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      white-space: nowrap;
      overflow-x: auto;
    }
    
    .install-step:last-child {
      margin-bottom: 0;
    }
    
    .install-step .command {
      flex: 1;
      min-width: 0;
    }
    
    /* Copy button */
    .copy-btn {
      flex-shrink: 0;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 2px;
      width: 16px;
      height: 16px;
      border-radius: 3px;
      position: relative;
    }
    
    .copy-btn:hover { opacity: 1; }
    
    .copy-btn::before,
    .copy-btn::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      opacity: 0.5;
      border: 1.5px solid #888;
    }
    
    .copy-btn::before {
      top: 0;
      right: 0;
      background: transparent;
    }
    
    .copy-btn::after {
      bottom: 0;
      left: 0;
      background: #1e1e1e;
    }

    /* Example code - light */
    .example-code {
      position: relative;
      padding: 12px;
      max-height: 380px;
      overflow: auto;
      background: #fafafa;
      color: #333;
    }
    
    .example-code pre {
      margin: 0;
      white-space: pre;
    }
    
    .example-code > .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      opacity: 0.3;
    }
    
    .example-code > .copy-btn::after {
      background: #fafafa;
    }
    
    .example-code > .copy-btn:hover {
      opacity: 1;
    }

    /* Responsive - stack early at 700px */
    @media screen and (max-width: 700px) {
      .grid-row {
        grid-template-columns: 1fr;
      }
      
      .feature-image {
        max-width: 280px;
      }
      
      main > header h2 {
        font-size: 28px;
      }
      
      #latestrelease {
        margin-top: 20px;
      }
      
      .tab-bar {
        gap: 3px;
      }
      
      .lang-tabs button {
        padding: 3px 6px;
        font-size: 10px;
      }
      
      .tab-bar select {
        padding: 3px 4px;
        font-size: 10px;
      }
    }
  </style>
</head>

<body>
  <div class="center">
  <aside>
    <header>
      <h1 style="display:none;">Azul GUI Framework</h1>
      <img src="./logo.svg">
    </header>
    <!-- SIDEBAR -->
  </aside>
  <main>
    <header class="grid-row">
      <div>
        <h2>Built for beauty and speed</h2>
        <p class="tagline">Cross-platform MIT-licensed Desktop GUI framework for C, C++, Python and Rust, using the Mozilla WebRender rendering engine</p>
      </div>
      <div id="latestrelease">
        <p><strong>v$$LATEST_VERSION$$</strong></p>
        <p>$$LATEST_DATE$$</p>
        <a href="https://azul.rs/release/$$LATEST_VERSION$$.html">release notes</a>
        <a href="https://azul.rs/api/$$LATEST_VERSION$$.html">api docs</a>
        <a href="https://azul.rs/guide.html">user guide</a>
      </div>
    </header>
    
    $$INDEX_SECTION_EXAMPLES$$
  </main>
  </div>
  
  <script type="text/javascript">
    var examples = $$JAVASCRIPT_EXAMPLES$$;
    var installationConfig = $$JAVASCRIPT_INSTALLATION$$;
    
    var currentLang = 'rust';
    var currentOS = detectOS();
    var currentCppVersion = 'cpp23';
    var currentInstallMethod = {};
    
    // Init from localStorage
    (function() {
      var savedLang = localStorage.getItem('azul-lang');
      var savedOS = localStorage.getItem('azul-os');
      var savedCpp = localStorage.getItem('azul-cpp-version');
      var savedMethods = localStorage.getItem('azul-install-methods');
      
      if (savedLang) currentLang = savedLang;
      if (savedOS) currentOS = savedOS;
      if (savedCpp) currentCppVersion = savedCpp;
      if (savedMethods) {
        try { currentInstallMethod = JSON.parse(savedMethods); } catch(e) {}
      }
      
      // Check if savedLang is a dialect variant (will be validated after functions load)
    })();
    
    function detectOS() {
      var platform = window.navigator?.userAgentData?.platform || window.navigator.platform;
      var mac = ['macOS', 'Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];
      var win = ['Win32', 'Win64', 'Windows', 'WinCE'];
      if (mac.indexOf(platform) !== -1) return 'macos';
      if (win.indexOf(platform) !== -1) return 'windows';
      return 'linux';
    }
    
    function selectLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('azul-lang', lang);
      // If this is a dialect variant (e.g., cpp23), also update the dialect version
      var langConfig = installationConfig.languages[lang];
      if (langConfig && langConfig.dialectOf === 'cpp') {
        currentCppVersion = lang;
        localStorage.setItem('azul-cpp-version', lang);
      }
      updateAllUI();
    }
    
    function selectOS(os) {
      currentOS = os;
      localStorage.setItem('azul-os', os);
      updateAllUI();
    }
    
    function selectInstallMethod(method) {
      var baseLang = currentLang.startsWith('cpp') ? 'cpp' : currentLang;
      currentInstallMethod[baseLang] = method;
      localStorage.setItem('azul-install-methods', JSON.stringify(currentInstallMethod));
      updateAllUI();
    }
    
    // Get the base language group (e.g., cpp23 -> cpp, rust -> rust)
    function getBaseLang(lang) {
      var langConfig = installationConfig.languages[lang];
      if (langConfig && langConfig.dialectOf) {
        return langConfig.dialectOf;
      }
      return lang;
    }
    
    // Check if a language is a dialect (variant) of another language group
    function isDialect(lang) {
      var langConfig = installationConfig.languages[lang];
      return langConfig && langConfig.dialectOf;
    }
    
    // Get the current dialect variant for a dialect group
    function getCurrentDialectVariant(dialectGroup) {
      if (dialectGroup === 'cpp') return currentCppVersion;
      return dialectGroup; // fallback
    }
    
    function getMethods(lang) {
      // For dialects, check the actual language key (e.g., cpp23) for methods
      var langConfig = installationConfig.languages[lang];
      if (!langConfig || !langConfig.methods) return [];
      return langConfig.methods;
    }
    
    function getInstallMethod(lang) {
      var baseLang = getBaseLang(lang);
      var methods = getMethods(lang);
      if (methods.length === 0) return 'default';
      return currentInstallMethod[baseLang] || methods[0];
    }
    
    // Get dialect variants for a dialect group (from dialects config)
    function getDialectVariants(dialectGroup) {
      var dialect = installationConfig.dialects[dialectGroup];
      if (!dialect) return {};
      return dialect.variants;
    }
    
    function updateAllUI() {
      // Update language buttons
      document.querySelectorAll('.lang-grid button').forEach(function(btn) {
        var lang = btn.getAttribute('data-lang');
        btn.classList.remove('active');
        if (lang === currentLang) {
          btn.classList.add('active');
        } else if (isDialect(currentLang) && lang === getBaseLang(currentLang)) {
          // Highlight the dialect group button when a variant is selected
          btn.classList.add('active');
        }
      });
      
      // Show/hide dialect version selects (e.g., C++ version dropdown)
      var dialectGroup = getBaseLang(currentLang);
      var isCurrentDialect = isDialect(currentLang);
      
      document.querySelectorAll('select.cpp-version').forEach(function(sel) {
        if (isCurrentDialect || installationConfig.dialects[currentLang]) {
          sel.style.display = 'inline-block';
          // Populate with variants from dialects config
          var variants = getDialectVariants(dialectGroup);
          var html = '';
          Object.keys(variants).forEach(function(varKey) {
            var v = variants[varKey];
            html += '<option value="' + varKey + '">' + v.displayName + '</option>';
          });
          sel.innerHTML = html;
          sel.value = currentCppVersion;
        } else {
          sel.style.display = 'none';
        }
      });
      
      // Update OS selects
      document.querySelectorAll('select.os-select').forEach(function(sel) {
        sel.value = currentOS;
      });
      
      // Update method selects - only show if > 1 method available for current language
      var methods = getMethods(currentLang);
      document.querySelectorAll('select.method-select').forEach(function(sel) {
        if (methods.length <= 1) {
          sel.style.display = 'none';
        } else {
          sel.style.display = 'inline-block';
          // Populate options
          sel.innerHTML = methods.map(function(m) {
            return '<option value="' + m + '">' + m + '</option>';
          }).join('');
          sel.value = getInstallMethod(currentLang);
        }
      });
      
      // Update install commands (only on first section)
      document.querySelectorAll('.feature-section[data-is-first="true"] .install-commands').forEach(updateInstallCommands);
      
      // Update example code
      Object.keys(examples).forEach(updateExampleCode);
      
      // Update images
      updateImages();
    }
    
    function updateInstallCommands(container) {
      // For installation, use the actual language key (e.g., cpp23 for specific install steps)
      var langConfig = installationConfig.languages[currentLang];
      
      if (!langConfig) {
        container.innerHTML = '<div class="install-step"><span class="command">Select a language</span></div>';
        return;
      }
      
      var steps = null;
      // Check for method-based installation (e.g., pip vs uv for Python)
      if (langConfig.methods && langConfig.methods.length > 0 && langConfig.methodSteps) {
        var method = getInstallMethod(currentLang);
        steps = langConfig.methodSteps[method];
      }
      // Fall back to platform-specific steps
      if (!steps) {
        steps = langConfig[currentOS];
      }
      
      if (!steps || steps.length === 0) {
        container.innerHTML = '';
        return;
      }
      
      var html = '';
      steps.forEach(function(step) {
        if (step.type === 'command') {
          html += '<div class="install-step">' +
            '<span class="command">' + escHtml(step.content) + '</span>' +
            '<button class="copy-btn" onclick="copyText(\'' + escJs(step.content) + '\')"></button>' +
            '</div>';
        } else if (step.type === 'code') {
          html += '<div class="install-step">' +
            '<pre style="margin:0;flex:1;">' + escHtml(step.content) + '</pre>' +
            '<button class="copy-btn" onclick="copyText(\'' + escJs(step.content) + '\')"></button>' +
            '</div>';
        } else if (step.type === 'text') {
          html += '<div class="install-step"><span class="command" style="color:#888;">' + escHtml(step.content) + '</span></div>';
        }
      });
      
      container.innerHTML = html;
    }
    
    function updateExampleCode(id) {
      var ex = examples[id];
      if (!ex) return;
      
      var code = ex['code_' + currentLang];
      // For dialect variants, try the specific variant first, then fallback
      if (!code && isDialect(currentLang)) {
        code = ex['code_' + currentCppVersion] || ex['code_cpp23'] || '';
      }
      if (!code) code = '';
      
      var el = document.getElementById('example-code-' + id);
      if (el) {
        el.innerHTML = '<pre>' + escHtml(code) + '</pre>' +
          '<button class="copy-btn" onclick="copyExampleCode(\'' + id + '\')"></button>';
      }
    }
    
    function updateImages() {
      document.querySelectorAll('.showcase').forEach(function(img) { img.style.display = 'none'; });
      var cls = currentOS === 'macos' ? 'mac' : currentOS;
      document.querySelectorAll('.showcase.' + cls).forEach(function(img) { img.style.display = 'block'; });
    }
    
    function copyText(t) {
      navigator.clipboard.writeText(t);
    }
    
    function copyExampleCode(id) {
      var ex = examples[id];
      if (!ex) return;
      var code = ex['code_' + currentLang];
      if (!code && isDialect(currentLang)) {
        code = ex['code_' + currentCppVersion] || ex['code_cpp23'] || '';
      }
      if (code) navigator.clipboard.writeText(code);
    }
    
    function escHtml(t) {
      return t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }
    
    function escJs(t) {
      return t.replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/\n/g, "\\n").replace(/\r/g, "");
    }
    
    document.addEventListener("DOMContentLoaded", updateAllUI);
  </script>
</body>
</html>
