<!DOCTYPE html>
<html lang="en">
<head>
  <title>Azul GUI Framework</title>
  <!-- HEAD -->
</head>

<body>
  <div class="center">
  <aside>
    <header>
      <h1 style="display:none;">Azul GUI Framework</h1>
      <img src="./logo.svg">
    </header>
    <!-- SIDEBAR -->
  </aside>
  <main>
    <header class="grid-row">
      <div>
        <h1>Built for beauty and speed.</h1>
        <p class="tagline">Cross-platform MIT-licensed Desktop GUI framework for C, C++, Python and Rust, using the Mozilla WebRender rendering engine</p>
      </div>
      <div id="latestrelease">
        <p><strong>v$$LATEST_VERSION$$</strong></p>
        <p>$$LATEST_DATE$$</p>
        <a href="https://azul.rs/release/$$LATEST_VERSION$$.html">release notes</a>
        <a href="https://azul.rs/api/$$LATEST_VERSION$$.html">api docs</a>
        <a href="https://azul.rs/guide.html">user guide</a>
      </div>
    </header>
    
    $$INDEX_SECTION_EXAMPLES$$
  </main>
  </div>
  
  <script type="text/javascript">
    var examples = $$JAVASCRIPT_EXAMPLES$$;
    var installationConfig = $$JAVASCRIPT_INSTALLATION$$;
    
    var currentLang = 'rust';
    var currentOS = detectOS();
    var currentCppVersion = 'cpp23';
    var currentInstallMethod = {};
    
    // Init from localStorage
    (function() {
      var savedLang = localStorage.getItem('azul-lang');
      var savedOS = localStorage.getItem('azul-os');
      var savedCpp = localStorage.getItem('azul-cpp-version');
      var savedMethods = localStorage.getItem('azul-install-methods');
      
      if (savedLang) currentLang = savedLang;
      if (savedOS) currentOS = savedOS;
      if (savedCpp) currentCppVersion = savedCpp;
      if (savedMethods) {
        try { currentInstallMethod = JSON.parse(savedMethods); } catch(e) {}
      }
      
      // Check if savedLang is a dialect variant (will be validated after functions load)
    })();
    
    function detectOS() {
      var platform = (window.navigator?.userAgentData?.platform || window.navigator.platform || '').toLowerCase();
      if (platform.indexOf('mac') !== -1) return 'macos';
      if (platform.indexOf('win') !== -1) return 'windows';
      return 'linux';
    }
    
    function selectLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('azul-lang', lang);
      // If this is a dialect variant (e.g., cpp23), also update the dialect version
      var langConfig = installationConfig.languages[lang];
      if (langConfig && langConfig.dialectOf === 'cpp') {
        currentCppVersion = lang;
        localStorage.setItem('azul-cpp-version', lang);
      }
      updateAllUI();
    }
    
    function selectOS(os) {
      currentOS = os;
      localStorage.setItem('azul-os', os);
      updateAllUI();
    }
    
    function selectInstallMethod(method) {
      var baseLang = currentLang.startsWith('cpp') ? 'cpp' : currentLang;
      currentInstallMethod[baseLang] = method;
      localStorage.setItem('azul-install-methods', JSON.stringify(currentInstallMethod));
      updateAllUI();
    }
    
    // Get the base language group (e.g., cpp23 -> cpp, rust -> rust)
    function getBaseLang(lang) {
      var langConfig = installationConfig.languages[lang];
      if (langConfig && langConfig.dialectOf) {
        return langConfig.dialectOf;
      }
      return lang;
    }
    
    // Check if a language is a dialect (variant) of another language group
    function isDialect(lang) {
      var langConfig = installationConfig.languages[lang];
      return langConfig && langConfig.dialectOf;
    }
    
    // Get the current dialect variant for a dialect group
    function getCurrentDialectVariant(dialectGroup) {
      if (dialectGroup === 'cpp') return currentCppVersion;
      return dialectGroup; // fallback
    }
    
    function getMethods(lang) {
      // For dialects, check the actual language key (e.g., cpp23) for methods
      var langConfig = installationConfig.languages[lang];
      if (!langConfig || !langConfig.methods) return [];
      return langConfig.methods;
    }
    
    function getInstallMethod(lang) {
      var baseLang = getBaseLang(lang);
      var methods = getMethods(lang);
      if (methods.length === 0) return 'default';
      return currentInstallMethod[baseLang] || methods[0];
    }
    
    // Get dialect variants for a dialect group (from dialects config)
    function getDialectVariants(dialectGroup) {
      var dialect = installationConfig.dialects[dialectGroup];
      if (!dialect) return {};
      return dialect.variants;
    }
    
    function updateAllUI() {
      // Update language buttons and dialect dropdowns
      document.querySelectorAll('.lang-grid button').forEach(function(btn) {
        var lang = btn.getAttribute('data-lang');
        btn.classList.remove('active');
        if (lang === currentLang) {
          btn.classList.add('active');
        } else if (isDialect(currentLang) && lang === getBaseLang(currentLang)) {
          // Highlight the dialect group button when a variant is selected
          btn.classList.add('active');
        }
      });
      
      // Update dialect dropdown tabs (e.g., C++ with version selector)
      document.querySelectorAll('.lang-tab-dropdown').forEach(function(dropdown) {
        var lang = dropdown.getAttribute('data-lang');
        dropdown.classList.remove('active');
        if (lang === currentLang || (isDialect(currentLang) && lang === getBaseLang(currentLang))) {
          dropdown.classList.add('active');
        }
        // Update the dialect select value
        var sel = dropdown.querySelector('.dialect-select');
        if (sel && isDialect(currentLang) && lang === getBaseLang(currentLang)) {
          sel.value = currentLang;
        }
      });
      
      // Show/hide dialect version selects in install-controls (legacy, can be removed)
      var dialectGroup = getBaseLang(currentLang);
      var isCurrentDialect = isDialect(currentLang);
      
      document.querySelectorAll('select.cpp-version').forEach(function(sel) {
        // Hide these - dialect is now selected via the tab dropdown
        sel.style.display = 'none';
      });
      
      // Update OS selects
      document.querySelectorAll('select.os-select').forEach(function(sel) {
        sel.value = currentOS;
      });
      
      // Update method selects - only show if > 1 method available for current language
      var methods = getMethods(currentLang);
      document.querySelectorAll('select.method-select').forEach(function(sel) {
        if (methods.length <= 1) {
          sel.style.display = 'none';
        } else {
          sel.style.display = 'inline-block';
          // Populate options
          sel.innerHTML = methods.map(function(m) {
            return '<option value="' + m + '">' + m + '</option>';
          }).join('');
          sel.value = getInstallMethod(currentLang);
        }
      });
      
      // Update install commands (on all sections that have install-commands visible)
      document.querySelectorAll('.feature-section .install-commands').forEach(updateInstallCommands);
      
      // Update example code
      Object.keys(examples).forEach(updateExampleCode);
      
      // Update images
      updateImages();
    }
    
    function updateInstallCommands(container) {
      // For installation, use the actual language key (e.g., cpp23 for specific install steps)
      var langConfig = installationConfig.languages[currentLang];
      
      if (!langConfig) {
        container.innerHTML = '<div class="install-step"><span class="command">Select a language</span></div>';
        return;
      }
      
      var steps = null;
      // Check for method-based installation (e.g., pip vs uv for Python)
      if (langConfig.methods && langConfig.methods.length > 0 && langConfig.methodSteps) {
        var method = getInstallMethod(currentLang);
        steps = langConfig.methodSteps[method];
      }
      // Fall back to platform-specific steps
      if (!steps) {
        steps = langConfig[currentOS];
      }
      
      if (!steps || steps.length === 0) {
        container.innerHTML = '';
        return;
      }
      
      var html = '';
      steps.forEach(function(step) {
        if (step.type === 'command') {
          html += '<div class="install-step">' +
            '<span class="command">' + escHtml(step.content) + '</span>' +
            '<button class="copy-btn" onclick="copyText(\'' + escJs(step.content) + '\')"></button>' +
            '</div>';
        } else if (step.type === 'code') {
          html += '<div class="install-step">' +
            '<pre style="margin:0;flex:1;">' + escHtml(step.content) + '</pre>' +
            '<button class="copy-btn" onclick="copyText(\'' + escJs(step.content) + '\')"></button>' +
            '</div>';
        } else if (step.type === 'text') {
          html += '<div class="install-step"><span class="command" style="color:#888;">' + escHtml(step.content) + '</span></div>';
        }
      });
      
      container.innerHTML = html;
    }
    
    function updateExampleCode(id) {
      var ex = examples[id];
      if (!ex) return;
      
      var code = ex['code_' + currentLang];
      // For dialect variants, try the specific variant first, then fallback
      if (!code && isDialect(currentLang)) {
        code = ex['code_' + currentCppVersion] || ex['code_cpp23'] || '';
      }
      if (!code) code = '';
      
      // Map language to Prism language class
      var prismLang = currentLang;
      if (currentLang.startsWith('cpp')) prismLang = 'cpp';
      if (currentLang === 'c') prismLang = 'c';
      if (currentLang === 'python') prismLang = 'python';
      if (currentLang === 'rust') prismLang = 'rust';
      
      var el = document.getElementById('example-code-' + id);
      if (el) {
        var codeEl = document.createElement('code');
        codeEl.className = 'language-' + prismLang;
        codeEl.textContent = code;
        
        var preEl = document.createElement('pre');
        preEl.appendChild(codeEl);
        
        el.innerHTML = '';
        el.appendChild(preEl);
        el.insertAdjacentHTML('beforeend', '<button class="copy-btn" onclick="copyExampleCode(\'' + id + '\')"></button>');
        
        // Apply Prism highlighting
        if (typeof Prism !== 'undefined') {
          Prism.highlightElement(codeEl);
        }
      }
    }
    
    function updateImages() {
      document.querySelectorAll('.showcase').forEach(function(img) { img.style.display = 'none'; });
      var cls = currentOS === 'macos' ? 'mac' : currentOS;
      document.querySelectorAll('.showcase.' + cls).forEach(function(img) { img.style.display = 'block'; });
    }
    
    function copyText(t) {
      navigator.clipboard.writeText(t);
    }
    
    function copyExampleCode(id) {
      var ex = examples[id];
      if (!ex) return;
      var code = ex['code_' + currentLang];
      if (!code && isDialect(currentLang)) {
        code = ex['code_' + currentCppVersion] || ex['code_cpp23'] || '';
      }
      if (code) navigator.clipboard.writeText(code);
    }
    
    function escHtml(t) {
      return t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }
    
    function escJs(t) {
      return t.replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/\n/g, "\\n").replace(/\r/g, "");
    }
    
    document.addEventListener("DOMContentLoaded", updateAllUI);
  </script>
  <!-- PRISM_SCRIPT -->
</body>
</html>
