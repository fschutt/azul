<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azul Debugger</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="./debugger.css">
</head>
<body>

    <!-- Menu Bar -->
    <div class="menubar">
        <div class="menu-item">
            File
            <div class="menu-dropdown">
                <div class="menu-dropdown-item" onclick="app.handlers.newTest()">
                    <span class="material-icons" style="font-size:18px">add</span>
                    New Test
                </div>
                <div class="menu-dropdown-item" onclick="document.getElementById('file-input').click()">
                    <span class="material-icons" style="font-size:18px">upload_file</span>
                    Import Test(s)...
                </div>
            </div>
        </div>
        <div class="menu-item">
            Import
            <div class="menu-dropdown">
                <div class="menu-dropdown-item" onclick="app.handlers.refreshSidebar()">
                    <span class="material-icons" style="font-size:18px">code</span>
                    UI from HTML
                </div>
                <div class="menu-dropdown-item" onclick="document.getElementById('file-input').click()">
                    <span class="material-icons" style="font-size:18px">note_add</span>
                    E2E Test(s)
                </div>
            </div>
        </div>
        <div class="menu-item">
            Export
            <div class="menu-dropdown">
                <div class="menu-dropdown-item" onclick="app.handlers.exportWorkspace()">
                    <span class="material-icons" style="font-size:18px">save</span>
                    Workspace as JSON
                </div>
                <div class="menu-dropdown-item" onclick="app.handlers.exportTests()">
                    <span class="material-icons" style="font-size:18px">save_alt</span>
                    E2E Test(s)
                </div>
            </div>
        </div>
        <div style="flex:1"></div>
        <div class="menu-item" id="connection-status" style="color: var(--warning)">Disconnected</div>
    </div>

    <!-- Hidden file input (for import) -->
    <input type="file" id="file-input" class="hidden" accept=".json" onchange="app.handlers.importFile(this)">

    <!-- Main Workbench -->
    <div class="workbench">

        <!-- Activity Bar -->
        <div class="activity-bar">
            <div class="activity-icon active" data-view="inspector" onclick="app.ui.switchView('inspector')">
                <span class="material-icons">account_tree</span>
            </div>
            <div class="activity-icon" data-view="testing" onclick="app.ui.switchView('testing')">
                <span class="material-icons">bug_report</span>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <span id="sidebar-title">DOM Explorer</span>
                <span class="material-icons" style="font-size:16px; cursor:pointer" onclick="app.handlers.refreshSidebar()">refresh</span>
            </div>

            <!-- Inspector sidebar -->
            <div id="sidebar-inspector" class="sidebar-content mono" style="font-size:12px;">
                <div style="padding:10px; color:var(--text-muted)">Loading DOM...</div>
            </div>

            <!-- Testing sidebar -->
            <div id="sidebar-testing" class="sidebar-content hidden">
                <div class="btn-row">
                    <button class="btn-primary" onclick="app.handlers.newTest()">+ New Test</button>
                </div>
                <div id="test-list-container"></div>
                <hr style="border-color:var(--border); margin:10px 0;">
                <div class="btn-row">
                    <button class="btn-primary" onclick="app.runner.runServerSide()" title="Run the selected test on the server (StubWindow)">
                        <span class="material-icons" style="font-size:14px;vertical-align:middle">play_arrow</span> Run Test
                    </button>
                    <button class="btn-primary" onclick="app.runner.runAllServerSide()" title="Run ALL tests on the server in parallel">
                        <span class="material-icons" style="font-size:14px;vertical-align:middle">play_circle</span> Run All
                    </button>
                </div>
                <div id="run-status" class="hidden" style="padding:10px; text-align:center; color:var(--text-muted)">
                    <span class="spinner"></span> Running...
                </div>
            </div>
        </div>

        <!-- Main Editor -->
        <div class="editor-group">
            <div class="editor-tabs">
                <div class="tab">
                    <span class="material-icons" style="font-size:14px; color:var(--accent)">description</span>
                    <span id="tab-title">main.html</span>
                </div>
            </div>

            <div class="editor-content">

                <!-- View: Inspector -->
                <div id="view-inspector" class="flex" style="height:100%; padding:20px; flex-direction:column;">
                    <h3>UI Preview</h3>
                    <div style="color:var(--text-muted); margin-bottom:10px;">
                        Visual representation of the node structure.
                    </div>
                    <div id="dom-preview" class="mono" style="background:var(--bg-sidebar); padding:15px; border-radius:4px; overflow:auto; white-space:pre; flex:1;">
                        &lt;!-- DOM content will appear here --&gt;
                    </div>
                </div>

                <!-- View: Testing -->
                <div id="view-testing" class="hidden" style="height:100%; position:relative; display:flex; flex-direction:column;">
                    <!-- Floating controls -->
                    <div class="floating-controls">
                        <button class="icon-btn success" title="Run Test (client-side)" onclick="app.runner.run()"><span class="material-icons">play_arrow</span></button>
                        <button class="icon-btn" title="Pause" onclick="app.runner.pause()"><span class="material-icons">pause</span></button>
                        <button class="icon-btn" title="Step Over" onclick="app.runner.step()"><span class="material-icons">redo</span></button>
                        <button class="icon-btn danger" title="Stop/Reset" onclick="app.runner.reset()"><span class="material-icons">stop</span></button>
                    </div>
                    <div id="steps-container" class="step-list">
                        <div style="text-align:center; padding:20px; color:var(--text-muted);">
                            No test selected or empty test.
                        </div>
                    </div>
                    <div style="padding:10px; border-top:1px solid var(--border); flex-shrink:0;">
                        <button class="btn-primary" style="width:auto;" onclick="app.ui.showAddStepForm()">+ Add Step</button>
                    </div>
                </div>
            </div>

            <!-- Bottom Panel (Terminal) -->
            <div class="bottom-panel">
                <div class="panel-header">
                    <span>Terminal</span>
                    <span style="opacity:0.5">Debug Console</span>
                </div>
                <div id="terminal-output" class="terminal-output"></div>
                <div class="terminal-input-row">
                    <span style="color:var(--accent); margin-right:5px;">&gt;</span>
                    <input type="text" id="terminal-cmd" class="terminal-input" placeholder='{"op": "get_state"}' onkeydown="if(event.key==='Enter') app.handlers.terminalEnter(this)">
                </div>
            </div>
        </div>

        <!-- Secondary Sidebar (Properties / Step Details / Screenshot) -->
        <div class="secondary-sidebar">
            <div class="sidebar-header">Properties / Details</div>
            <div id="prop-panel" class="sidebar-content">
                <div id="details-content" style="padding:10px;">
                    <p style="color:var(--text-muted)">Select a node or test step to view details.</p>
                </div>
            </div>
        </div>

    </div>

    <!-- Screenshot Modal (full-size preview) -->
    <div id="screenshot-modal" class="modal" onclick="this.classList.remove('active')">
        <div class="modal-content" style="max-width:90%; max-height:90%;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span>Screenshot Preview</span>
                <span class="material-icons" style="cursor:pointer" onclick="document.getElementById('screenshot-modal').classList.remove('active')">close</span>
            </div>
            <div class="modal-body" style="text-align:center; overflow:auto;">
                <img id="screenshot-modal-img" style="max-width:100%;" />
            </div>
        </div>
    </div>
</body>

<script src="./debugger.js" type="application/javascript"></script>
</html>
