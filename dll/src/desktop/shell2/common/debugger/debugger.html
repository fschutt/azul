<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azul Debugger</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="./debugger.css">
</head>
<body>

    <!-- Menu Bar -->
    <div class="menubar" id="menubar">
        <div class="menu-item" data-menu="import">
            Import
            <div class="menu-dropdown">
                <div class="menu-dropdown-item" onclick="app.handlers.importProject()">
                    <span class="material-icons mi">folder_open</span>
                    Project from JSON...
                </div>
                <div class="menu-dropdown-separator"></div>
                <div class="menu-dropdown-item" onclick="app.handlers.importE2eTests()">
                    <span class="material-icons mi">note_add</span>
                    E2E Tests (append)...
                </div>
            </div>
        </div>
        <div class="menu-item" data-menu="export">
            Export
            <div class="menu-dropdown">
                <div class="menu-dropdown-item" onclick="app.handlers.exportProject()">
                    <span class="material-icons mi">save</span>
                    Project as JSON
                </div>
                <div class="menu-dropdown-separator"></div>
                <div class="menu-dropdown-item" onclick="app.handlers.exportE2eTests()">
                    <span class="material-icons mi">save_alt</span>
                    E2E Tests (CLI format)
                </div>
            </div>
        </div>
        <div style="flex:1"></div>
        <div id="connection-status" style="padding:4px 8px; color: var(--warning); cursor:default; font-size:12px;">Disconnected</div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="file-import-project" class="hidden" accept=".json" onchange="app.handlers.handleProjectImport(this)">
    <input type="file" id="file-import-e2e" class="hidden" accept=".json" onchange="app.handlers.handleE2eImport(this)">

    <!-- Main Workbench -->
    <div class="workbench">

        <!-- Activity Bar -->
        <div class="activity-bar">
            <div class="activity-icon active" data-view="inspector" onclick="app.ui.switchView('inspector')" title="DOM Inspector">
                <span class="material-icons">account_tree</span>
            </div>
            <div class="activity-icon" data-view="testing" onclick="app.ui.switchView('testing')" title="E2E Testing">
                <span class="material-icons">bug_report</span>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <span id="sidebar-title">DOM Explorer</span>
                <span class="material-icons clickable" style="font-size:16px" onclick="app.handlers.refreshSidebar()" title="Refresh">refresh</span>
            </div>

            <!-- Inspector sidebar: DOM Tree -->
            <div id="sidebar-inspector" class="sidebar-content">
                <div id="dom-tree-container" class="dom-tree">
                    <div class="placeholder-text">Loading DOM tree...</div>
                </div>
            </div>

            <!-- Testing sidebar -->
            <div id="sidebar-testing" class="sidebar-content hidden">
                <div class="btn-row">
                    <button class="btn-primary" onclick="app.handlers.newTest()">+ New Test</button>
                </div>
                <div id="test-list-container"></div>
                <hr style="border-color:var(--border); margin:10px 0;">
                <div class="btn-row">
                    <button class="btn-primary" onclick="app.runner.runServerSide()" title="Run selected test on server">
                        <span class="material-icons" style="font-size:14px;vertical-align:middle">play_arrow</span> Run
                    </button>
                    <button class="btn-primary" onclick="app.runner.runAllServerSide()" title="Run ALL tests on server">
                        <span class="material-icons" style="font-size:14px;vertical-align:middle">play_circle</span> All
                    </button>
                </div>
                <div id="run-status" class="hidden" style="padding:10px; text-align:center; color:var(--text-muted)">
                    <span class="spinner"></span> Running...
                </div>
            </div>
        </div>

        <!-- Main Editor -->
        <div class="editor-group">
            <div class="editor-tabs">
                <div class="tab">
                    <span class="material-icons" style="font-size:14px; color:var(--accent)">description</span>
                    <span id="tab-title">Inspector</span>
                </div>
            </div>

            <div class="editor-content">

                <!-- View: Inspector (Node Details) -->
                <div id="view-inspector" style="height:100%; display:flex; flex-direction:column; overflow:hidden;">
                    <div id="node-detail-panel" style="flex:1; overflow:auto; padding:15px;">
                        <div class="placeholder-text">Select a node in the DOM Explorer to inspect it.</div>
                    </div>
                </div>

                <!-- View: Testing -->
                <div id="view-testing" class="hidden" style="height:100%; position:relative; display:flex; flex-direction:column;">
                    <div class="floating-controls">
                        <button class="icon-btn success" title="Run (client)" onclick="app.runner.run()"><span class="material-icons">play_arrow</span></button>
                        <button class="icon-btn" title="Pause" onclick="app.runner.pause()"><span class="material-icons">pause</span></button>
                        <button class="icon-btn" title="Step" onclick="app.runner.step()"><span class="material-icons">redo</span></button>
                        <button class="icon-btn danger" title="Reset" onclick="app.runner.reset()"><span class="material-icons">stop</span></button>
                    </div>
                    <div id="steps-container" class="step-list">
                        <div class="placeholder-text">No test selected.</div>
                    </div>
                    <div style="padding:10px; border-top:1px solid var(--border); flex-shrink:0;">
                        <button class="btn-primary" style="width:auto;" onclick="app.ui.showAddStepForm()">+ Add Step</button>
                    </div>
                </div>
            </div>

            <!-- Bottom Panel -->
            <div class="bottom-panel">
                <div class="panel-tabs">
                    <div class="panel-tab active" data-panel="terminal" onclick="app.ui.switchPanel('terminal')">Terminal</div>
                    <div class="panel-tab" data-panel="debug" onclick="app.ui.switchPanel('debug')">Debug Console</div>
                </div>
                <div id="panel-terminal" class="terminal-output"></div>
                <div id="panel-debug" class="terminal-output hidden"></div>
                <div class="terminal-input-row">
                    <span style="color:var(--accent); margin-right:5px;">&gt;</span>
                    <input type="text" id="terminal-cmd" class="terminal-input" placeholder='{"op": "get_state"}' onkeydown="if(event.key==='Enter') app.handlers.terminalEnter(this)">
                </div>
            </div>
        </div>

        <!-- Secondary Sidebar (Properties / CSS) -->
        <div class="secondary-sidebar">
            <div class="sidebar-header">Properties</div>
            <div id="prop-panel" class="sidebar-content">
                <div id="details-content" style="padding:10px;">
                    <div class="placeholder-text">Select a node or test step.</div>
                </div>
            </div>
        </div>

    </div>

    <!-- Context Menu (DOM tree right-click) -->
    <div id="context-menu" class="context-menu hidden">
        <div class="context-menu-item" onclick="app.handlers.ctxInsertChild('div')">Insert child &lt;div&gt;</div>
        <div class="context-menu-item" onclick="app.handlers.ctxInsertChild('span')">Insert child &lt;span&gt;</div>
        <div class="context-menu-item" onclick="app.handlers.ctxInsertChild('p')">Insert child &lt;p&gt;</div>
        <div class="context-menu-item" onclick="app.handlers.ctxInsertChild('button')">Insert child &lt;button&gt;</div>
        <div class="context-menu-item" onclick="app.handlers.ctxInsertChild('text')">Insert child (text)</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="app.handlers.ctxDeleteNode()">Delete node</div>
    </div>

    <!-- Screenshot Modal -->
    <div id="screenshot-modal" class="modal" onclick="this.classList.remove('active')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span>Screenshot</span>
                <span class="material-icons clickable" onclick="document.getElementById('screenshot-modal').classList.remove('active')">close</span>
            </div>
            <div class="modal-body" style="text-align:center; overflow:auto;">
                <img id="screenshot-modal-img" style="max-width:100%;" />
            </div>
        </div>
    </div>
</body>

<script src="./debugger.js" type="application/javascript"></script>
</html>
